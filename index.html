<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>12-Note Player (Polyphonic)</title>
<style>
  body {
    font-family: sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #111;
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    touch-action: manipulation;
  }

  .container {
    display: grid;
    grid-template-columns: repeat(4, 80px);
    gap: 12px;
  }

  button {
    width: 80px;
    height: 80px;
    border: none;
    border-radius: 12px;
    background: #444;
    color: white;
    font-size: 18px;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    touch-action: manipulation;
  }

  button.active {
    background: #2ecc71;
    transform: scale(0.95);
  }
</style>
</head>
<body>

  <div>
    <div class="container" id="soundContainer"></div>
    <br>
    <div class="container" id="buttons"></div>
</div>

<script>
  const sounds = ["sine", "triangle", "square", "sawtooth"];
  const soundContainer = document.getElementById("soundContainer");

  // Create a button for sound type
  sounds.forEach(sound => {
    const btn = document.createElement('button');
    btn.textContent = sound;
    soundContainer.appendChild(btn);

    // Change the sound setting when new sound selected
    btn.addEventListener('pointerdown', e => {
      [...soundContainer.children].forEach(child => child.classList.remove('active'));
      localStorage.setItem('soundSelection', sound);
      btn.classList.add('active')
    });

  });

 const notes = [
  // Top row — Sharps/Flats
  { name: 'C♯', freq: 277.18, keystroke: 'w' },
  { name: 'D♯', freq: 311.13, keystroke: 'e' },
  { name: 'F♯', freq: 369.99, keystroke: 't' },
  { name: 'G♯', freq: 415.30, keystroke: 'y' },
  { name: 'A♯', freq: 466.16, keystroke: 'u' },
  { name: 'C♯′', freq: 554.37, keystroke: 'o' },
  { name: 'D♯′', freq: 622.25, keystroke: 'p' },

  // Middle row — Main C major scale (extends beyond one octave)
  { name: 'C',  freq: 261.63, keystroke: 'a' },
  { name: 'D',  freq: 293.66, keystroke: 's' },
  { name: 'E',  freq: 329.63, keystroke: 'd' },
  { name: 'F',  freq: 349.23, keystroke: 'f' },
  { name: 'G',  freq: 392.00, keystroke: 'g' },
  { name: 'A',  freq: 440.00, keystroke: 'h' },
  { name: 'B',  freq: 493.88, keystroke: 'j' },
  { name: 'C′', freq: 523.25, keystroke: 'k' },
  { name: 'D′', freq: 587.33, keystroke: 'l' },
  { name: "E′", freq: 659.26, keystroke: ';' },
  { name: "F′", freq: 698.46, keystroke: "'" },

  // Bottom row — Bass notes (one octave below)
  { name: 'C (bass)',  freq: 130.81, keystroke: 'x' },
  { name: 'D (bass)',  freq: 146.83, keystroke: 'c' },
  { name: 'E (bass)',  freq: 164.81, keystroke: 'v' },
  { name: 'F (bass)',  freq: 174.61, keystroke: 'b' },
  { name: 'G (bass)',  freq: 196.00, keystroke: 'n' },
  { name: 'A (bass)',  freq: 220.00, keystroke: 'm' },
  { name: 'B (bass)',  freq: 246.94, keystroke: ',' },
  { name: 'C′ (bass)', freq: 261.63, keystroke: '.' },
  { name: 'D′ (bass)', freq: 293.66, keystroke: '/' },
];

  const container = document.getElementById('buttons');
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const activeOscillators = new Map();

  // Play note

  const playNote = (noteName, noteFrequency, noteKeystroke) => {
    if (activeOscillators.has(noteName)) return; // already playing
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = localStorage.getItem('soundSelection');
    osc.frequency.value = noteFrequency;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
    osc.start();
    activeOscillators.set(noteName, { osc, gain });
  }

  // Create a button for each note
  notes.forEach(note => {
    const btn = document.createElement('button');
    btn.textContent = note.name;
    container.appendChild(btn);

    // Start the note when note button is pressed
    btn.addEventListener('pointerdown', e => {
      playNote(note.name, note.freq, note.keystroke);
      btn.classList.add('active');
    });

    // Stop the note when note button is released
    btn.addEventListener('pointerup', e => stopNote(note.name, btn));
    btn.addEventListener('pointerleave', e => stopNote(note.name, btn));
    btn.addEventListener('pointercancel', e => stopNote(note.name, btn));

    // Start note when note keystroke is pressed
    document.addEventListener('keydown', (event) => {
      if (note.keystroke.includes(event.key)) {
        playNote(note.name, note.freq, note.keystroke);
        btn.classList.add('active');
      }
    });
    
    // Stop note when note keystroke is released
   document.addEventListener('keyup', (event) => {
      if (note.keystroke.includes(event.key)) {
        stopNote(note.name, btn);
      }
    });

  });

  

  function stopNote(name, btn) {
    const data = activeOscillators.get(name);
    if (data) {
      const { osc, gain } = data;
      gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
      osc.stop(audioCtx.currentTime + 0.1);
      activeOscillators.delete(name);
      btn.classList.remove('active');
    }
  }

  // Resume audio context on first user interaction (required by browsers)
  document.body.addEventListener('click', () => {
    if (audioCtx.state === 'suspended') {
      audioCtx.resume();
    }
  }, { once: true });
</script>

</body>
</html>
